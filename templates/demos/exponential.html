
{% extends "base.html" %}
{% block content %}
<h1>Exponential Function (L2-13 to L2-16)</h1>
<p>
This demo describes the complex exponential function as described on pages L2-13 to L2-16 in the script.
The complex time function is described by \(x(t)=\hat{X}\cdot \mathrm e^{st}\) with the complex frequency \(s=\sigma+\mathrm{j}\omega\).
The amplitude \(|\hat{X}|\), the angular frequency \(\omega\), the damping \(\sigma\) and a phase shift \(\varphi\) can be set.
The following applies: \(\hat{X} = |\hat{X}|\cdot \mathrm e^{\mathrm{j}\cdot\varphi}\)
</p>

<div class="demo row">
  <div class="card">
    <div class="kv">
      <div><strong>Magnitude \(|\hat X|\)</strong></div>
      <div class="hstack">
        <input id="magnitude" type="range" min="0" max="2" step="0.1" value="{{ defaults.magnitude }}"> <span id="magnitude_val">{{ defaults.magnitude }}</span>
      </div>

      <div><strong>Phase \(\varphi\) [rad]</strong></div>
      <div class="hstack">
        <input id="phase" type="range" min="{{ -pi/2 }}" max="{{ pi/2 }}" step="{{ pi/8 }}" value="{{ defaults.phase }}"> <span id="phase_val">{{ defaults.phase }}</span>
      </div>
      
      <div><strong>Real part \(\sigma\)</strong></div>
      <div class="hstack">
        <input id="sigma" type="range" min="-0.5" max="0.5" step="0.1" value="{{ defaults.sigma }}"> <span id="sigma_val">{{ defaults.sigma }}</span>
      </div>

      <div><strong>Frequency \(\omega\)</strong></div>
      <div class="hstack">
        <input id="omega" type="range" min="-10" max="10" step="1" value="{{ defaults.omega }}"> <span id="omega_val">{{ defaults.omega }}</span>
      </div>

      <div><strong>Time \(t\)</strong></div>
      <div class="hstack"><input id="time" type="range" min="0" max="{{ t_max }}" step="0.25" value="{{ defaults.time }}"> <span id="time_val">{{ defaults.time }}</span></div>

      <div><strong>Mode</strong></div>
      <div class="hstack">
        <div>
          <input type="radio" id="mode_entirely" name="mode" value="Entirely" {% if defaults.mode == "Entirely" %}checked{% endif %}><label for="mode_entirely">Entirely</label>
        </div>
        <div>
          <input type="radio" id="mode_until_t" name="mode" value="Until t" {% if defaults.mode == "Until t" %}checked{% endif %}><label for="mode_until_t">Until t</label>
        </div>
      </div>
    </div>
    <div class="toolbar">
      <button id="run">Update</button>
      <button id="reset">Reset</button>
    </div>

  </div>

  <div class="card">
    <img id="plot" alt="plot">
  </div>
</div>
{% endblock %}


{% block scripts %}
<script>
  const $ = (id) => document.getElementById(id);
  function getMode(){
    const r = document.querySelector('input[name="mode"]:checked');
    return r ? r.value : "Until t";
  }
  function payload(){
    return {
      magnitude: parseFloat($("magnitude").value),
      phase: parseFloat($("phase").value),
      omega: parseFloat($("omega").value),
      sigma: parseFloat($("sigma").value),
      time: parseFloat($("time").value),
      mode: getMode(),
    };
  }
  function syncLabels(){
    $("magnitude_val").textContent = $("magnitude").value;
    $("phase_val").textContent = Math.round(parseFloat($("phase").value)*100)/100;
    $("omega_val").textContent = $("omega").value;
    $("sigma_val").textContent = $("sigma").value;
    $("time_val").textContent = $("time").value;
  }

  async function recompute(){
    syncLabels();
    try{
      const res = await fetch("./compute", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(payload())
      });
      const data = await res.json();
      if(data.error){
        alert(data.error);
        return;
      }
      $("plot").src = data.image;
      if (window.MathJax && MathJax.typeset) { MathJax.typeset(); }
    }catch(e){
      console.error(e);
      alert(e);
    }
  }

  ["magnitude","phase","omega","sigma","time"].forEach(id => {
    $(id).addEventListener("input", () => syncLabels());
    $(id).addEventListener("input", () => recompute());
  });
  document.querySelectorAll('input[name="mode"]').forEach(r => r.addEventListener("change", () => recompute()));
  $("run").addEventListener("click", () => recompute());
  $("reset").addEventListener("click", () => {
    $("magnitude").value = "{{ defaults.magnitude }}";
    $("phase").value = "{{ defaults.phase }}";
    $("omega").value = "{{ defaults.omega }}";
    $("sigma").value = "{{ defaults.sigma }}";
    $("time").value = "{{ defaults.time }}";
    $("mode_entirely").checked = "{{ defaults.mode == 'Entirely' }}";
    $("mode_until_t").checked = "{{ defaults.mode == 'Until t' }}";
    syncLabels();
    recompute();
  });

  // initial draw
  recompute();
</script>
{% endblock %}
