{% extends "base.html" %}
{% block content %}
<div class="lloyd-page">
  <div class="lloyd-hero">
    <div class="hero-text">
      <p class="eyebrow">Lloyd-Max quantization</p>
      <h1>Iterate Lloyd-Max on Lenna</h1>
      <p>Step through the iterative design of a 16-level Lloyd-Max quantizer, watch the decision thresholds move, and compare the reconstruction to a uniform quantizer.</p>
      <div class="hero-actions">
        <div class="lenna-chip">
          <img src="{{ lenna_src }}" alt="Lenna preview">
          <div>
            <div class="chip-label">Lenna 512×512</div>
            <div class="chip-sub">Used for histogram + quantization</div>
          </div>
        </div>
        <div class="controls-stack">
          <label class="slider-block">
            <span>Iterations</span>
            <input type="range" id="iteration-slider" min="0" max="8" step="1" value="1">
            <div class="slider-meta">
              <span id="iteration-count">1</span>
              <span class="slider-hint">0 = initial uniform thresholds</span>
            </div>
          </label>
          <div class="level-toggle" role="group" aria-label="Quantization levels">
            <button type="button" data-level="16" class="active">16 levels</button>
            <button type="button" data-level="8">8 levels</button>
          </div>
        </div>
      </div>
    </div>
    <div class="hero-plot">
      <div id="lloyd-plot" class="plot-card" aria-label="Lloyd-Max histogram plot"></div>
    </div>
  </div>

  <section class="quantization-grid">
    <article class="quant-card">
      <div class="quant-header">
        <div class="quant-title-row">
          <h2>Uniform quantization <span id="uniform-level-label">using 16 levels</span></h2>
          <div class="level-toggle compact" role="group" aria-label="Uniform levels">
            <button type="button" data-level="16" class="active">16</button>
            <button type="button" data-level="8">8</button>
          </div>
        </div>
        <p class="quant-metric"><span class="metric-label">SNR</span> <span id="uniform-snr">—</span> · <span class="metric-label">PSNR</span> <span id="uniform-psnr">—</span></p>
      </div>
      <div class="quant-body">
        <img id="uniform-image" alt="Uniformly quantized Lenna" loading="lazy">
        <div id="uniform-curve" class="curve"></div>
      </div>
    </article>
    <article class="quant-card">
      <div class="quant-header">
        <h2>Lloyd-Max quantization <span id="lloyd-level-label">using 16 levels</span></h2>
        <p class="quant-metric"><span class="metric-label">SNR</span> <span id="lloyd-snr">—</span> · <span class="metric-label">PSNR</span> <span id="lloyd-psnr">—</span></p>
      </div>
      <div class="quant-body">
        <img id="lloyd-image" alt="Lloyd-Max quantized Lenna" loading="lazy">
        <div id="lloyd-curve" class="curve"></div>
      </div>
    </article>
  </section>
</div>

<style>
  .lloyd-page { display: flex; flex-direction: column; gap: 32px; }
  .lloyd-hero { display: grid; grid-template-columns: minmax(0, 1fr) minmax(520px, 1.4fr); gap: 24px; align-items: stretch; background: linear-gradient(135deg, rgba(11, 94, 189, 0.08), rgba(11, 94, 189, 0.02)); border: 1px solid rgba(13, 53, 109, 0.08); border-radius: 18px; padding: clamp(18px, 2vw, 26px); box-shadow: 0 12px 30px rgba(13, 53, 109, 0.12); }
  body.dark-mode .lloyd-hero { background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(30, 64, 98, 0.82)); border-color: rgba(148, 173, 215, 0.26); box-shadow: 0 16px 38px rgba(0, 0, 0, 0.32); }
  .hero-text { display: grid; gap: 12px; }
  .eyebrow { margin: 0; letter-spacing: 0.1em; text-transform: uppercase; font-weight: 700; color: #0b5ebd; }
  body.dark-mode .eyebrow { color: #8dc8ff; }
  .hero-text h1 { margin: 0; font-size: clamp(1.8rem, 3vw, 2.4rem); color: #0e1a2b; }
  body.dark-mode .hero-text h1 { color: #e5edff; }
  .hero-text p { margin: 0; color: #3c4253; line-height: 1.6; }
  body.dark-mode .hero-text p { color: #c9d5f3; }
  .hero-actions { display: grid; gap: 14px; align-items: stretch; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
  .lenna-chip { display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: center; border: 1px solid rgba(11, 94, 189, 0.18); background: rgba(255, 255, 255, 0.7); border-radius: 12px; padding: 10px; box-shadow: 0 6px 16px rgba(15, 35, 95, 0.08); }
  .lenna-chip img { width: 68px; height: 68px; border-radius: 12px; object-fit: cover; border: 1px solid rgba(13, 53, 109, 0.2); }
  .chip-label { font-weight: 700; color: #0e1a2b; }
  .chip-sub { font-size: 0.9rem; color: #53607a; }
  body.dark-mode .lenna-chip { background: rgba(17, 24, 39, 0.92); border-color: rgba(148, 173, 215, 0.26); box-shadow: 0 10px 22px rgba(0,0,0,0.35); }
  body.dark-mode .lenna-chip img { border-color: rgba(148, 173, 215, 0.35); }
  body.dark-mode .chip-label { color: #e8f1ff; }
  body.dark-mode .chip-sub { color: #b8c6e8; }
  .controls-stack { display: grid; gap: 10px; }
  .slider-block { display: grid; gap: 6px; color: #0e1a2b; font-weight: 700; }
  .slider-block input[type=range] { width: 100%; accent-color: #0b5ebd; }
  .slider-meta { display: flex; justify-content: space-between; color: #53607a; font-weight: 500; font-size: 0.95rem; }
  body.dark-mode .slider-block { color: #dfe8ff; }
  body.dark-mode .slider-meta { color: #a7b4d6; }
  .hero-plot { background: #fff; border-radius: 14px; border: 1px solid rgba(13,53,109,0.1); box-shadow: 0 12px 26px rgba(13,53,109,0.12); padding: 12px; min-height: 420px; }
  body.dark-mode .hero-plot { background: rgba(17,24,39,0.94); border-color: rgba(148, 173, 215, 0.24); box-shadow: 0 16px 32px rgba(0,0,0,0.35); }
  .plot-card { width: 100%; height: 100%; min-height: 380px; }
  .quantization-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 18px; }
  .quant-card { background: #fff; border: 1px solid rgba(13,53,109,0.08); border-radius: 14px; padding: 16px; box-shadow: 0 10px 24px rgba(13,53,109,0.08); display: grid; gap: 12px; }
  body.dark-mode .quant-card { background: rgba(17,24,39,0.95); border-color: rgba(148,173,215,0.24); box-shadow: 0 14px 30px rgba(0,0,0,0.32); }
  .quant-header h2 { margin: 0; font-size: 1.2rem; color: #0e1a2b; }
  .quant-header p { margin: 2px 0 0 0; color: #53607a; }
  body.dark-mode .quant-header h2 { color: #e6edff; }
  body.dark-mode .quant-header p { color: #a7b4d6; }
  .quant-body { display: grid; gap: 10px; }
  .quant-body img { width: 100%; border-radius: 10px; border: 1px solid rgba(13,53,109,0.16); box-shadow: 0 6px 16px rgba(13,53,109,0.08); }
  body.dark-mode .quant-body img { border-color: rgba(148, 173, 215, 0.28); box-shadow: 0 10px 22px rgba(0,0,0,0.35); }
  .curve { width: 100%; height: 180px; }
  .metric-label { color: #0b5ebd; font-weight: 700; }
  body.dark-mode .metric-label { color: #8dc8ff; }
  .level-toggle { display: inline-flex; gap: 6px; align-items: center; }
  .level-toggle button { border: 1px solid rgba(13,53,109,0.14); background: rgba(255,255,255,0.9); color: #0e1a2b; padding: 6px 10px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: all 0.15s ease; }
  .level-toggle button.active { background: #0b5ebd; border-color: #0b5ebd; color: #fff; box-shadow: 0 8px 16px rgba(11,94,189,0.24); }
  .level-toggle button:not(.active):hover { border-color: rgba(11,94,189,0.32); }
  body.dark-mode .level-toggle button { background: rgba(17,24,39,0.9); color: #e6edff; border-color: rgba(148,173,215,0.24); }
  body.dark-mode .level-toggle button:not(.active):hover { border-color: rgba(148,173,215,0.45); }
  .level-toggle.compact button { padding: 4px 8px; font-size: 0.95rem; }
  .quant-title-row { display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap; }
  @media (max-width: 960px) { .lloyd-hero { grid-template-columns: 1fr; } }
</style>

<script src="{{ url_for('static', filename='js/plotly.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/lloyd_max_demo.js') }}" defer></script>
<script>
  window.LLOYD_MAX_DEMO = {
    imageSrc: "{{ lenna_src }}",
    levels: 16,
    maxIterations: 8,
  };
</script>
{% endblock %}