{% extends "base.html" %}

{% block content %}
<div class="inverse-laplace-container" style="max-width: 900px; margin: auto;">
  <div class="page-header text-center mb-5">
    <h1 class="text-2xl font-semibold" style="text-align: center;">Inverse Laplace Transform</h1>
    <p class="text-gray-600" style="text-align: center;">Enter a causal system function \(H(s)\) to calculate and plot its time-domain impulse response \(h(t)\) or step response \(s(t)\).<br>
      The expression \(as^2+bs+c\) can be expressed as either <code>[a, b, c]</code> or <code>as^2+bs+c</code>.</p>
  </div>

  <form method="POST">
    <fieldset>
      <legend class="font-medium mb-2">System Function \(H(s)\)</legend>
      <label for="numerator">Numerator
        <input type="text" id="numerator" name="numerator" value="{{ default_num }}" placeholder="[1]" title="Polynomial coefficients or expression in s" required>
      </label>
      {% if num_error %}
        <p class="text-red-600 text-sm mt-1">{{ num_error }}</p>
      {% endif %}

      <label for="denominator" style="margin-top:1rem;">Denominator
        <input type="text" id="denominator" name="denominator" value="{{ default_den }}" placeholder="[1, 1]" title="Polynomial coefficients or expression in s" required>
      </label>
      {% if den_error %}
        <p class="text-red-600 text-sm mt-1">{{ den_error }}</p>
      {% endif %}

      <div class="examples" style="font-size: 1.2rem;">
        <button type="button" class="example-btn" data-expr="1/(s**2+3*s+2)">\(\frac{1}{s^2+3s+2}\)</button>
        <button type="button" class="example-btn" data-expr="(s+2)/(s**2+4)">\(\frac{s+2}{s^2+4}\)</button>
        <button type="button" class="example-btn" data-expr="s/(s+1)">\(\frac{s}{s+1}\)</button>
      </div>
    </fieldset>

    <fieldset class="radio-group">
      <legend class="font-medium mb-2">Output Type</legend>
      <label><input type="radio" name="response_type" value="impulse" {% if response_type != 'step' %}checked{% endif %}> Impulse response</label>
      <label><input type="radio" name="response_type" value="step" {% if response_type == 'step' %}checked{% endif %}> Step response</label>
    </fieldset>

    <div class="button-group">
      <button type="submit" class="compute-btn">Compute</button>
      <button type="button" class="clear-btn" id="clear-btn">Clear</button>
    </div>
    {% if error %}
      <div class="text-red-600 mt-2">{{ error }}</div>
    {% endif %}
  </form>

  {% if sf_latex %}
    <div style="text-align:center;">
      <h2>System Function</h2>
      <p>$$
        {% if pfd_latex %}
          \begin{align}
          H(s) &= {{ sf_latex|safe }}\\
          &= {{ pfd_latex|safe }}
          \end{align}
        {% else %}
          H(s) = {{ sf_latex|safe }}
        {% endif %}
      $$</p>
    </div>
  {% endif %}

  {% if time_signal_latex %}
    <div class="result" style="text-align:center;margin-top:2rem;">
      <h2>{{ title }}</h2>
      <p>$$ {{ time_signal_latex|safe }} $$</p>
      <img src="data:image/png;base64,{{ plot_url }}" alt="{{ title }} plot" class="plot">
    </div>
  {% endif %}
</div>
<script>
  document.querySelectorAll('.example-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const [num, den] = btn.dataset.expr.split('/');
      document.getElementById('numerator').value = num;
      document.getElementById('denominator').value = den;
    });
  });

  const clearBtn = document.getElementById('clear-btn');
  if (clearBtn) {
    clearBtn.addEventListener('click', () => {
      document.getElementById('numerator').value = '';
      document.getElementById('denominator').value = '';
      const impulseRadio = document.querySelector('input[name="response_type"][value="impulse"]');
      if (impulseRadio) {
        impulseRadio.checked = true;
      }
    });
  }
</script>
{% endblock %}